// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// User model - main participant in competitions
model User {
  id              String  @id @default(auto()) @map("_id") @db.ObjectId
  name            String
  email           String  @unique
  password        String
  phone           String?
  institution     String?
  avatarUrl       String?
  isActive        Boolean @default(true)
  isEmailVerified Boolean @default(false)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  verificationTokens  VerificationToken[]
  passwordResetTokens PasswordResetToken[]
}

// Email verification tokens
model VerificationToken {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  token     String    @unique
  userId    String    @db.ObjectId
  type      TokenType @default(EMAIL_VERIFICATION)
  expiresAt DateTime
  used      Boolean   @default(false)
  createdAt DateTime  @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// Password reset tokens
model PasswordResetToken {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  token     String   @unique
  userId    String   @db.ObjectId
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

enum TokenType {
  EMAIL_VERIFICATION
  WELCOME_EMAIL
}

// Optional: Competition model for future use
// model Competition {
//   id          String   @id @default(auto()) @map("_id") @db.ObjectId
//   title       String
//   description String
//   startDate   DateTime
//   endDate     DateTime
//   isActive    Boolean  @default(true)
//   createdAt   DateTime @default(now())
//   updatedAt   DateTime @updatedAt
//   
//   participants User[] @relation("UserCompetitions")
//   submissions  Submission[]
// }

// Optional: Submission model for future use
// model Submission {
//   id            String      @id @default(auto()) @map("_id") @db.ObjectId
//   title         String
//   description   String?
//   fileUrl       String
//   category      String
//   userId        String      @db.ObjectId
//   competitionId String      @db.ObjectId
//   isActive      Boolean     @default(true)
//   createdAt     DateTime    @default(now())
//   updatedAt     DateTime    @updatedAt
//   
//   user          User        @relation(fields: [userId], references: [id])
//   competition   Competition @relation(fields: [competitionId], references: [id])
// }
